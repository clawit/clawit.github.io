<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Configure Ldap plugin</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         Â© 2018 Passbolt SARL

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/help/2018/09/AD_ldap_overview.png" />
    <meta property="og:title" content="Configure Ldap plugin" />
    <meta property="og:description" content="" />

    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="canonical" href="https://help.passbolt.com/configure/ldap-from-configuration-file">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">

</head>

<body>
<div id="container" class="help page background">
    <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" target="_blank" rel="noopener"><span>demo</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="//help.passbolt.com/"><span>help</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_posts/2018-09-06-configure-ldap-configuration-file.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>
    <div class="panel main" aria-label="Content">
        <div class="panel left">
            
            







<div class="navigation wizard" role="navigation">
    <ul>
        <li><h2>Configure</h2></li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/configure/ldap">Configure LDAP</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/configure/mfa/yubikey">Configure Yubikey</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/configure/mfa/duo">Configure Duo</a>
        </li>
        
    </ul>
</div>







            
        </div>
        <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
            <div class="grid grid-responsive-12">
                <article>
                    <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/configure"><span>configure</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/configure/"><span></span></a>
                    </div>
                </li>
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/configure/ldap-from-configuration-file.html"><span>ldap-from-configuration-file</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                    <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Configure Ldap plugin</h1>
</div>
</div>

                    <div class="row">
  <div class="col7">

    <div class="message warning">
    <p>
        <strong>Important:</strong> The Ldap plugin is part of <a href="https://www.passbolt.com/pricing/pro">Passbolt Pro</a> only and is not available in the Community Edition.
    </p>
    
</div>

    <h2 id="introduction">Introduction</h2>

    <h3 id="what-is-it">What is it?</h3>

    <p>The goal of the directory synchronization tool, also called LDAP connector, is to provide a way for a passbolt 
administrator to synchronize a list of groups and users, as well as the associated group memberships.</p>

    <p>Currently the connector supports two types of directory: OpenLDAP and Microsoft Active Directory. In the future 
we will also support other non ldap based user directories such as Google API User Directory.</p>

    <h3 id="how-does-it-work">How does it work?</h3>

    <p>In a nutshell this part of the application will try to keep passbolt and a directory in sync with a minimal 
involvement of the administrators and group managers. However if an action is not possible, such as, deleting 
a user that is the sole password owner, the process triggers will trigger relevant email notifications so 
that a human can solve it manually. An admin can also alternatively tell passbolt to ignore a record in the 
next synchronization round, if the issue does not need to be resolved.</p>

    <h3 id="requirements">Requirements</h3>

    <p>The directory synchronization tools requires the <a href="https://secure.php.net/manual/en/book.ldap.php">php-ldap extension</a>
to be present on the server. If you built your own server the way you install 
<a href="https://packages.debian.org/stretch/php-ldap">php-ldap</a> will depend on your system flavor.</p>

    <p>On Debian using nginx for example you can do:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>php-ldap 
<span class="nb">sudo </span>service nginx restart
</code></pre></div>    </div>

    <p>Make sure the ldap extension is present in the php-cli.ini file. 
You should add <code class="highlighter-rouge">extension=ldap.so</code> if it is not already present:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>php <span class="nt">-i</span> |grep php<span class="se">\.</span>ini
Configuration File <span class="o">(</span>php.ini<span class="o">)</span> Path <span class="o">=&gt;</span> /etc/php/7.0/cli
Loaded Configuration File <span class="o">=&gt;</span> /etc/php/7.0/cli/php.ini
<span class="nv">$ </span>nano /etc/php/7.0/cli/php.ini
</code></pre></div>    </div>

    <p>For testing purpose, it might be handy to have some <a href="https://wiki.debian.org/LDAP/LDAPUtils">ldap utilities</a> 
installed on your system. On Debian you can use ldapsearch for example to search for and display entries:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>ldap-utils
ldapsearch <span class="nt">-b</span><span class="s1">'dc=example,dc=com'</span> <span class="nt">-x</span>
</code></pre></div>    </div>

    <p>The plugin relies on a 3rd party library called ldaptools which you will need to install as part of your passbolt 
update or install. You can get it the same way than other php dependencies using composer:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /var/www/passbolt
git pull origin master
composer <span class="nb">install</span>
./bin/cake passbolt migrate
</code></pre></div>    </div>

    <p>To run, the ldap plugin needs to have at least one active admin user existing inside passbolt.</p>

    <h2 id="how-to-use">How to use?</h2>

    <div class="message warning">
    <p>
        <strong>Please note:</strong> This guide explains how to configure the Ldap connector through the configuration file. For simpler configurations, you can <a href="/configure/ldap">configure Ldap through the UI</a>.
    </p>
    
</div>

    <h3 id="activate-the-plugin">Activate the plugin</h3>

    <p>The plugin is deactivated by default. You need to activate it to be able to use it.</p>

    <p>To do so, simply copy the file <code class="highlighter-rouge">/config/ldap.default.php</code> into <code class="highlighter-rouge">ldap.php</code>.</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /var/www/passbolt
<span class="nb">mv</span> ./config/ldap.default.php ./config/ldap.php
</code></pre></div>    </div>

    <h3 id="configure-the-plugin">Configure the plugin</h3>

    <p>Edit the file <code class="highlighter-rouge">ldap.php</code> and modify the configuration to match your needs. The available options are:</p>

    <table class="table-parameters">
  <thead>
    <tr>
        <th width="25%">Parameter</th>
        <th width="33%">Details</th>
        <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
        <td>
        defaultUser<br />
        <em>(required)</em>
        </td>
        <td>
        Enter here the username of the passbolt admin user that will be used to perform the operations on behalf of the synchronization tools. 
        <br /><br />You can also create a dedicated admin user in passbolt if you want to be able to track more accurately the actions related to ldap.
        </td>
        <td>
        <code>passboltadmin@domain.com</code>
        </td>
    </tr>
    <tr>
        <td>
        defaultGroupAdminUser <br />
        <em>(required)</em>
        </td>
        <td>
        Enter here the username of the default group manager. It is the user that will be assigned as a group manager to all new groups created by ldap.
        </td>
        <td>
        <code>passboltadmin@domain.com</code>
        </td>
    </tr>
    <tr>
        <td>
        fieldsMapping <br />
        <em>(optional)</em>
        </td>
        <td>
        In case of OpenLdap, the default mapping between the passbolt and directory record fields might not be the one that will work for you. In this section you can redefine the default mapping for your directory.
        </td>
        <td><pre>'openldap' =&gt; [
  'user' =&gt; [
     'id' =&gt; 'entryUUID',
     'firstname' =&gt; 'firstName',
     'lastname' =&gt; 'lastName',
     'username' =&gt; 'mail',
     'created' =&gt; 'created',
     'modified' =&gt; 'modified',
  ],
  'group' =&gt; [
     'id' =&gt; 'entryUUID',
     'name' =&gt; 'cn',
     'created' =&gt; 'created',
     'modified' =&gt; 'modified',
     'users' =&gt; 'members',
  ],
],</pre></td>
     </tr>
     <tr>
         <td>
         groupObjectClass<br />
         <em>(optional)</em>
         </td>
         <td>
         For OpenLdap only, you can specify here the name of the group object class that you are using in your openldap.
         <br /><br />Default value: groupOfUniqueNames
         </td>
         <td>
         <code>groupOfUniqueNames</code>
         </td>
     </tr>
     <tr>
          <td>
          userObjectClass<br />
          <em>(optional)</em>
          </td>
          <td>
          For OpenLdap only, you can specify here the name of the user object class that you are using in your openldap.
          <br /><br />Default value: inetOrgPerson
          </td>
          <td>
          <code>inetOrgPerson</code>
          </td>
     </tr>
     <tr>
        <td>
        groupPath<br />
        <em>(optional)</em>
        </td>
        <td>
        If your groups are located in a different path than your base DN, you can specify here the complementary path.
        <br /><br />Default value: none
        </td>
        <td><code>OU=MyGroups</code></td>
     </tr>
     <tr>
         <td>
         userPath<br />
         <em>(optional)</em>
         </td>
         <td>
         If your users are located in a different path than your base DN, you can specify here the complementary path.
         <br /><br />Default value: none
         </td>
         <td><code>OU=MyUsers</code></td>
      </tr>
      <tr>
           <td>
           jobs<br />
           <em>(optional)</em>
           </td>
           <td>
           By default, the synchronization will be done for all created / deleted users and groups in your directory and all edited group members. You can enable / disable some tasks here.
           <br /><br />Default value: see example
           </td>
           <td><pre>'jobs' =&gt; [
    'users' =&gt; [
        'create' =&gt; true,
        'delete' =&gt; true,
    ],
    'groups' =&gt; [
        'create' =&gt; true,
        'update' =&gt; true,
        'delete' =&gt; true,
    ],
],
</pre></td>
        </tr>
        <tr>
             <td>
             ldap<br />
             <em>(required)</em>
             </td>
             <td>
             This contains the ldap connection details such as the domain name, username, password, base DN, servers, port, etc..
             The options in the config file are self explanatory.
             </td>
             <td><pre>'ldap' =&gt; [
  'domains' =&gt; [
      // Active directory.
     'mydomain.local' =&gt; [
          'domain_name' =&gt; 'mydomain.local',
          'username' =&gt; 'johndoe',
          'password' =&gt; 'Compl!c4t3dP4ssw0rD',
          'base_dn' =&gt; 'OU=OrgUsers,DC=mydomain,DC=local',
          'servers' =&gt; ['35.225.111.241'],
          'port' =&gt; 389,
          'use_ssl' =&gt; false,
         'ldap_type' =&gt; 'ad',
      ],
   ],
]</pre></td>
          </tr>
  </tbody>
</table>

    <h3 id="test-the-connection">Test the connection</h3>

    <p>Once the configuration options have been entered in ldap.php, you can test that the connection is working and that the objects are retrieved correctly from your directory:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/cake directory_sync <span class="nb">test</span>
</code></pre></div>    </div>

    <p>An output similar to the one below should be observed:</p>

    <figure>
    <img src="https://help.passbolt.com/assets/img/help/2018/09/AD_ldap_command_test.png" alt="Screenshot of directory synchronization test" style="max-width:750px;" />
    <span class="legend">fig. Screenshot of directory synchronization test</span>
</figure>

    <p><strong>What you should pay attention to:</strong></p>
    <ul>
      <li>Make sure that you can see the same groups and users as the ones available in your directory.</li>
      <li>Make sure that each user has an email address. If not, they will not validate in passbolt.</li>
      <li>Make sure that each group is shown with the right number of users.</li>
    </ul>

    <h3 id="first-synchronization">First synchronization</h3>
    <p>Before we actually do a real synchronization, we will first simulate one:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/cake directory_sync all <span class="nt">--dry-run</span>
</code></pre></div>    </div>
    <p>This command will simulate what will happen when the synchronization will be done for real.</p>

    <figure>
    <img src="https://help.passbolt.com/assets/img/help/2018/09/AD_ldap_command_dry_run.png" alt="Screenshot of directory synchronization sync in dry run" style="max-width:;" />
    <span class="legend">fig. Screenshot of directory synchronization sync in dry run</span>
</figure>

    <p>If the result displayed is similar to what you expect to happen, you can proceed with the actual synchronization:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/cake directory_sync all
</code></pre></div>    </div>

    <figure>
    <img src="https://help.passbolt.com/assets/img/help/2018/09/AD_ldap_command_sync.png" alt="Screenshot of directory synchronization running" style="max-width:;" />
    <span class="legend">fig. Screenshot of directory synchronization running</span>
</figure>

    <p class="message notice">
    Please note that a user can be added into a group only once his account is activated.
</p>

    <h3 id="run-it-automatically">Run it automatically</h3>
    <p>To synchronize the changes automatically you will need to add a cron job. We recommend to execute the job once a day, but you can choose as per your preference.</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0 0 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> su <span class="nt">-c</span> <span class="s2">"/var/www/passbolt/bin/cake directory_sync all"</span> <span class="nt">-s</span> /bin/bash www-data <span class="o">&gt;&gt;</span> /var/log/cron.log 2&gt;&amp;1
</code></pre></div>    </div>

    <h3 id="ignoring-records">Ignoring records</h3>
    <p>It is possible for you to individually ignore synchronization of some of your directory records and/or some users/groups in passbolt, especially when there are some problematics records you do not want to keep in sync. Such records and the command to ignore them will be displayed in the reports.</p>

    <figure>
    <img src="https://help.passbolt.com/assets/img/help/2018/09/AD_ldap_ignore_option.png" alt="Screenshot of directory synchronization with items to ignore" style="max-width:;" />
    <span class="legend">fig. Screenshot of directory synchronization with items to ignore</span>
</figure>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ./bin/cake directory_sync ignore-create <span class="nt">--id</span><span class="o">=</span>55872084-ed6f-4e96-b401-479dd86ca357 <span class="nt">--model</span><span class="o">=</span>DirectoryEntries
</code></pre></div>    </div>

    <p>You can also view all the records that are being ignored.</p>

    <figure>
    <img src="https://help.passbolt.com/assets/img/help/2018/09/AD_ldap_command_view_ignored.png" alt="Screenshot of directory synchronization view ignored command" style="max-width:;" />
    <span class="legend">fig. Screenshot of directory synchronization view ignored command</span>
</figure>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/cake directory_sync ignore-list
</code></pre></div>    </div>

    <p>You can also stop ignoring them:</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/cake directory_sync ignore-delete --id=16789f75-2cf7-4755-9bd9-634d1ff42240 --model=DirectoryEntries
</code></pre></div>    </div>

    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
September
7th,
2018.</p>
    </div>

  </div>
  <div class="col4 last push1">

    <div class="message tldr notice">
    <p>Are you experiencing issues with Passbolt Pro Edition?</p>
    <a href="mailto:contact@passbolt.com" class="button primary">Contact Pro support</a>
    <p>or <a href="https://community.passbolt.com">ask the community</a></p>

</div>

  </div>
</div>

                </article>
            </div>
        </div>
    </div>
    <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
</div>
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//passbolt.piwikpro.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//passbolt.piwikpro.com//piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>
</html>
